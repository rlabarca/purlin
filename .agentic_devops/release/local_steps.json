{
    "steps": [
        {
            "id": "doc_consistency_framework",
            "friendly_name": "Framework Documentation Consistency",
            "description": "Verifies that Purlin instruction files are internally consistent with each other and with the framework's README and PROCESS_HISTORY. Purlin-specific: consumer projects do not own instruction files.",
            "code": null,
            "agent_instructions": "Cross-reference `instructions/HOW_WE_WORK_BASE.md`, `instructions/ARCHITECT_BASE.md`, `instructions/BUILDER_BASE.md`, `instructions/QA_BASE.md`, and `features/policy_critic.md`. Check for: direct contradictions between files, stale file path references, terminology mismatches, and lifecycle/protocol definitions that differ between the shared philosophy and role-specific instructions. Also verify that README.md and PROCESS_HISTORY.md are consistent with the current instruction file content. Fix any inconsistencies and commit."
        },
        {
            "id": "critic_consistency_check",
            "friendly_name": "Critic Consistency Check & README Update",
            "description": "Cross-references all Critic-related specification and instruction files for inconsistencies in terminology, routing rules, and responsibilities. Halts the release if critical inconsistencies are found. Once clean, writes or updates the '## The Critic' section in README.md.",
            "code": null,
            "agent_instructions": "1. AUDIT PHASE — Read all of the following files:\n   - features/critic_tool.md (what the Critic does; dual-gate spec)\n   - features/policy_critic.md (invariants and configuration policy)\n   - instructions/HOW_WE_WORK_BASE.md Section 8 (Critic-Driven Coordination)\n   - instructions/ARCHITECT_BASE.md (Critic startup mentions)\n   - instructions/BUILDER_BASE.md (Critic startup mentions)\n   - instructions/QA_BASE.md (Critic mandate sections)\n\n2. CHECK FOR INCONSISTENCIES:\n   - Terminology: Does every file use 'coordination engine' (not 'quality gate')? The term 'Critic Quality Gate' is deprecated; flag any occurrences.\n   - Routing rules: Are BUG/DISCOVERY/INTENT_DRIFT/SPEC_DISPUTE routing rules consistent across policy_critic.md, HOW_WE_WORK_BASE.md Section 7.5, and QA_BASE.md? Flag any divergence.\n   - Role status values: Are builder and QA status enumerations (DONE/FAIL/TODO/INFEASIBLE vs CLEAN/N/A/TODO/DISPUTED/FAIL) consistent across all files?\n   - Deprecated config: Is critic_gate_blocking described as a no-op everywhere it appears? Flag any file that still treats it as active.\n   - Startup mandate: Does every role instruction file mandate running tools/cdd/status.sh at session start? Flag any omissions.\n   - CLI-only contract: Does every file that mentions the agent interface specify CLI (never HTTP)? Flag any contradictions.\n\n3. REPORT: Present a table of findings (CRITICAL / WARNING / OK) for each check.\n   - CRITICAL inconsistencies: Halt. Do not proceed to README update. Report which files must be fixed before this step can complete.\n   - WARNING inconsistencies: Present to user. Proceed only if user confirms.\n   - All OK: Proceed to step 4.\n\n4. README UPDATE — Write or update the '## The Critic' section in README.md.\n   - Section placement: immediately after '## The Agents' section, before '## Setup & Configuration'.\n   - If the section already exists, diff against the current content and update only what has drifted; do not discard customized wording without confirmation.\n   - Content to write:\n     a. What the Critic is (coordination engine, not a badge)\n     b. Dual-gate validation (Spec Gate + Implementation Gate) — one sentence each\n     c. Supplementary audits — bulleted list (User Testing, Builder Decisions, Visual Spec, Untracked Files)\n     d. Role-specific action items — brief table or bulleted list\n     e. CDD vs. Critic (one-line contrast)\n     f. CLI invocation: tools/cdd/status.sh (auto-runs Critic), tools/critic/run.sh\n\n5. Commit README.md with message: 'docs(readme): update Role of the Critic section'."
        }
    ]
}
